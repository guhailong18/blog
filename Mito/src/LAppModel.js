function LAppModel(){L2DBaseModel.prototype.constructor.call(this),this.modelHomeDir="",this.modelSetting=null,this.tmpMatrix=[]}LAppModel.prototype=new L2DBaseModel,LAppModel.prototype.load=function(e,t,i){this.setUpdating(!0),this.setInitialized(!1),this.modelHomeDir=t.substring(0,t.lastIndexOf("/")+1),this.modelSetting=new ModelSettingJson;var o=this;this.modelSetting.loadModelSetting(t,(function(){var t=o.modelHomeDir+o.modelSetting.getModelFile();o.loadModelData(t,(function(t){for(var l=0;l<o.modelSetting.getTextureNum();l++){var n=o.modelHomeDir+o.modelSetting.getTextureFile(l);o.loadTexture(l,n,(function(){if(o.isTexLoaded){if(o.modelSetting.getExpressionNum()>0){o.expressions={};for(var t=0;t<o.modelSetting.getExpressionNum();t++){var l=o.modelSetting.getExpressionName(t),n=o.modelHomeDir+o.modelSetting.getExpressionFile(t);o.loadExpression(l,n)}}else o.expressionManager=null,o.expressions={};if(null==o.eyeBlink&&(o.eyeBlink=new L2DEyeBlink),null!=o.modelSetting.getPhysicsFile()?o.loadPhysics(o.modelHomeDir+o.modelSetting.getPhysicsFile()):o.physics=null,null!=o.modelSetting.getPoseFile()?o.loadPose(o.modelHomeDir+o.modelSetting.getPoseFile(),(function(){o.pose.updateParam(o.live2DModel)})):o.pose=null,null!=o.modelSetting.getLayout()){var a=o.modelSetting.getLayout();null!=a.width&&o.modelMatrix.setWidth(a.width),null!=a.height&&o.modelMatrix.setHeight(a.height),null!=a.x&&o.modelMatrix.setX(a.x),null!=a.y&&o.modelMatrix.setY(a.y),null!=a.center_x&&o.modelMatrix.centerX(a.center_x),null!=a.center_y&&o.modelMatrix.centerY(a.center_y),null!=a.top&&o.modelMatrix.top(a.top),null!=a.bottom&&o.modelMatrix.bottom(a.bottom),null!=a.left&&o.modelMatrix.left(a.left),null!=a.right&&o.modelMatrix.right(a.right)}for(t=0;t<o.modelSetting.getInitParamNum();t++)o.live2DModel.setParamFloat(o.modelSetting.getInitParamID(t),o.modelSetting.getInitParamValue(t));for(t=0;t<o.modelSetting.getInitPartsVisibleNum();t++)o.live2DModel.setPartsOpacity(o.modelSetting.getInitPartsVisibleID(t),o.modelSetting.getInitPartsVisibleValue(t));o.live2DModel.saveParam(),o.live2DModel.setGL(e),o.preloadMotionGroup(LAppDefine.MOTION_GROUP_IDLE),o.mainMotionManager.stopAllMotions(),o.setUpdating(!1),o.setInitialized(!0),"function"==typeof i&&i()}}))}}))}))},LAppModel.prototype.release=function(e){var t=Live2DFramework.getPlatformManager();e.deleteTexture(t.texture)},LAppModel.prototype.preloadMotionGroup=function(e){for(var t=this,i=0;i<this.modelSetting.getMotionNum(e);i++){var o=this.modelSetting.getMotionFile(e,i);this.loadMotion(o,this.modelHomeDir+o,(function(o){o.setFadeIn(t.modelSetting.getMotionFadeIn(e,i)),o.setFadeOut(t.modelSetting.getMotionFadeOut(e,i))}))}},LAppModel.prototype.update=function(){if(null!=this.live2DModel){var e=2*((UtSystem.getUserTimeMSec()-this.startTimeMSec)/1e3)*Math.PI;this.mainMotionManager.isFinished()&&this.startRandomMotion(LAppDefine.MOTION_GROUP_IDLE,LAppDefine.PRIORITY_IDLE),this.live2DModel.loadParam(),this.mainMotionManager.updateParam(this.live2DModel)||null!=this.eyeBlink&&this.eyeBlink.updateParam(this.live2DModel),this.live2DModel.saveParam(),null==this.expressionManager||null==this.expressions||this.expressionManager.isFinished()||this.expressionManager.updateParam(this.live2DModel),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",30*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",30*this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",this.dragX*this.dragY*-30,1),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",10*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_X",this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_Y",this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",Number(15*Math.sin(e/6.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",Number(8*Math.sin(e/3.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",Number(10*Math.sin(e/5.5345)),.5),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",Number(4*Math.sin(e/15.5345)),.5),this.live2DModel.setParamFloat("PARAM_BREATH",Number(.5+.5*Math.sin(e/3.2345)),1),null!=this.physics&&this.physics.updateParam(this.live2DModel),null==this.lipSync&&this.live2DModel.setParamFloat("PARAM_MOUTH_OPEN_Y",this.lipSyncValue),null!=this.pose&&this.pose.updateParam(this.live2DModel),this.live2DModel.update()}else LAppDefine.DEBUG_LOG&&console.error("Failed to update.")},LAppModel.prototype.setRandomExpression=function(){var e=[];for(var t in this.expressions)e.push(t);var i=parseInt(Math.random()*e.length);this.setExpression(e[i])},LAppModel.prototype.startRandomMotion=function(e,t){var i=this.modelSetting.getMotionNum(e),o=parseInt(Math.random()*i);this.startMotion(e,o,t)},LAppModel.prototype.startMotion=function(e,t,i){var o=this.modelSetting.getMotionFile(e,t);if(null!=o&&""!=o){if(i==LAppDefine.PRIORITY_FORCE)this.mainMotionManager.setReservePriority(i);else if(!this.mainMotionManager.reserveMotion(i))return void(LAppDefine.DEBUG_LOG&&console.log("Motion is running."));var l,n=this;null==this.motions[e]?this.loadMotion(null,this.modelHomeDir+o,(function(o){l=o,n.setFadeInFadeOut(e,t,i,l)})):(l=this.motions[e],n.setFadeInFadeOut(e,t,i,l))}else LAppDefine.DEBUG_LOG&&console.error("Failed to motion.")},LAppModel.prototype.setFadeInFadeOut=function(e,t,i,o){var l=this.modelSetting.getMotionFile(e,t);if(o.setFadeIn(this.modelSetting.getMotionFadeIn(e,t)),o.setFadeOut(this.modelSetting.getMotionFadeOut(e,t)),LAppDefine.DEBUG_LOG&&console.log("Start motion : "+l),null==this.modelSetting.getMotionSound(e,t))this.mainMotionManager.startMotionPrio(o,i);else{var n=this.modelSetting.getMotionSound(e,t),a=document.createElement("audio");a.src=this.modelHomeDir+n,LAppDefine.DEBUG_LOG&&console.log("Start sound : "+n),a.play(),this.mainMotionManager.startMotionPrio(o,i)}},LAppModel.prototype.setExpression=function(e){var t=this.expressions[e];LAppDefine.DEBUG_LOG&&console.log("Expression : "+e),this.expressionManager.startMotion(t,!1)},LAppModel.prototype.draw=function(e){MatrixStack.push(),MatrixStack.multMatrix(this.modelMatrix.getArray()),this.tmpMatrix=MatrixStack.getMatrix(),this.live2DModel.setMatrix(this.tmpMatrix),this.live2DModel.draw(),MatrixStack.pop()},LAppModel.prototype.hitTest=function(e,t,i){for(var o=this.modelSetting.getHitAreaNum(),l=0;l<o;l++)if(e==this.modelSetting.getHitAreaName(l)){var n=this.modelSetting.getHitAreaID(l);return this.hitTestSimple(n,t,i)}return!1};